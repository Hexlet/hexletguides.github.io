<!doctype html>
<html amp lang="en">
  <head>
    <meta charset="utf-8">
    <title>Что такое DNS</title>
    <link rel="canonical" href="https://guides.hexlet.io/dns/" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <style amp-custom>
    </style>
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
      <script async src="https://cdn.ampproject.org/v0.js"></script>
  </head>
  <body>
    
    <h1 class="post-title">
      
    </h1>
    <span>
      2019-04-11 00:00:00 +0000 - Никита Михайлов
    </span>
    <p>Вы когда-нибудь задавались вопросом, как браузер понимает, какую именно страницу открыть когда вы вводите в строку адрес сайта? На самом деле, это глубокий вопрос, решать который стоит не непосредственно с перехода на сайты, а со связи компьютеров между собой.</p>

<p>В 70-х — 90-х годах 20 века существовала сеть под названием ARPANET. Это была попытка объединить множество компьютеров министерством обороны США для возможности передачи информации во время войны. Важность такого подхода заключалась в быстрой передачи информации на дальние расстояния. Впоследствии принципы работы ARPANET легли в основу современного интернета.</p>

<p>Изначально вся сеть объединяла компьютеры в четырёх различных институтах США:</p>

<ul>
  <li>Калифорнийский университет в Лос-Анджелесе;</li>
  <li>Стэнфордский исследовательский центр;</li>
  <li>Университет Юты;</li>
  <li>Калифорнийский университет в Санта-Барбаре.</li>
</ul>

<p>Учёные этих институтов быстро пришли к единому мнению, что передавать друг другу информацию об исследованиях удобнее при помощи новой сети. Для этого было достаточно знать идентификатор того компьютера, на который передаётся сообщение. Сейчас такие идентификаторы называются IP-адресами. У каждого устройства в интернете есть такой идентификатор и именно по нему обращаются устройства друг к другу.</p>

<p>В самом начале компьютеров, подключённых к сети, было несколько десятков, и их идентификаторы было легко запомнить. Можно было записать эти адреса в блокнот и использовать его так же, как и телефонные книги.</p>

<p>Время шло, и уже к середине 80-х годов вместо нескольких десятков компьютеров сеть стала насчитывать несколько тысяч. И каждый из них имел уникальный идентификатор, который становилось всё сложнее учитывать вручную или запоминать. Необходима была система, которая позволит очеловечить имена компьютеров и хранить все адреса в одном месте, чтобы каждый компьютер в сети имел один и тот же набор всех идентификаторов.</p>

<h2 id="файл-hosts--как-первый-шаг-к-созданию-dns">Файл hosts — как первый шаг к созданию DNS</h2>

<p>Для решения задачи разработчики решили использовать словарь, который связывал уникальное имя и IP-адрес каждого компьютера в сети. Таким словарём стал файл hosts.txt, который и отвечал за привязку IP-адреса к имени компьютера. Файл лежал на сервере Стэнфордского исследовательского института, и пользователи сети регулярно вручную скачивали этот файл на свои компьютеры, чтобы сохранять актуальность словаря, ведь новые компьютеры появлялись в сети почти каждый день.</p>

<p>Выглядел hosts.txt тогда (да и сейчас) таким образом:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>192.168.10.36         MIKE-STRATE-PC
Сетевой (IP) адрес    Имя компьютера
</code></pre></div></div>

<p>При наличии такого файла на компьютере пользователя для связи с компьютером Майка, можно было не запоминать цифры, а использовать понятное латинское имя «MIKE-STRATE-PC».</p>

<p>Посмотрим, как выглядит файл и попробуем добавить туда новое имя, чтобы подключиться к компьютеру с использованием данного имени. Для этого отредактируем файл hosts. Вы можете найти его на своём компьютере по следующему адресу:</p>

<ul>
  <li>В Unix-системах: <code class="language-plaintext highlighter-rouge">/etc/hosts</code>
</li>
  <li>В Windows-системах: <code class="language-plaintext highlighter-rouge">%Путь до папки Windows%/system32/drivers/etc/hosts</code>
</li>
</ul>

<script id="asciicast-FOqRvmFFMQPtruCnr59HEGAY3" src="https://asciinema.org/a/FOqRvmFFMQPtruCnr59HEGAY3.js" data-cols="80" data-rows="15" data-size="medium" data-preload="1" async=""></script>

<p>Компьютеру с IP-адресом 192.168.10.36, который находится внутри локальной сети мы указали имя «MIKE-STRATE-PC». После чего можно воспользоваться командой ping, которая пошлёт специальный запрос на компьютер Майка и будет ждать от него ответа. Похоже на то, как вы стучитесь в дверь или звоните в звонок, чтобы узнать, «есть ли кто дома?» Такой запрос можно послать на любой компьютер.</p>

<script id="asciicast-8H3jKqFsVUNyoxtzn7AWPJ1GH" src="https://asciinema.org/a/8H3jKqFsVUNyoxtzn7AWPJ1GH.js" data-cols="80" data-rows="15" data-size="medium" data-preload="1" async=""></script>

<p>По мере развития сети и «обрастания» её новыми клиентами, такой способ становился неудобным. Всем пользователям компьютеров было необходимо всё чаще скачивать свежую версию файла с сервера Стэнфордского исследовательского института, который обновлялся вручную несколько раз в неделю. Для добавлений же новых версий было необходимо связываться с институтом и просить их внести в файл новые значения.</p>

<p>В 1984 году Пол Мокапетрис (Paul Mockapetris) описал новую систему под названием DNS (Domain Name System / Система доменных имён), которая была призвана автоматизировать процессы соотнесения IP-адресов и имён компьютеров, а также процессы обновления имён у пользователей без необходимости ручного скачивания файла со стороннего сервера.</p>

<h2 id="работа-dns-в-сети-интернет">Работа DNS в сети интернет</h2>

<p>В настоящее время интернет окружает нас повсюду — мы используем его в мобильных и настольных устройствах. Системы видеонаблюдения и даже чайники взаимодействуют друг с другом с помощью интернета, и для корректной связи с ними нужна система, с помощью которой пользователи смогут одним запросом в адресной строке подключиться к нужному сервису. Всё это ложится на плечи системы DNS, которая внутри себя хранит намного больше информации, чем просто IP-адрес и название устройств. Записи в DNS также отвечают за корректную отправку электронных писем, связывают друг с другом разные домены и доменные зоны.</p>

<p>DNS является <a href="https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%91%D0%BD%D0%BD%D0%B0%D1%8F_%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0">распределённой системой</a>, а значит она имеет множество узлов, каждый из которых ответственен за свою зону. Такое возможно благодаря тому, что сама по себе структура DNS является иерархической, то есть выделяет зоны ответственности, где каждый родитель знает о расположении своего дочернего сервера, и знает зону его ответственности.</p>

<p><amp-img src="/assets/images/dns/hierarchy.jpg" alt="dns, hierarchy" layout="responsive"><noscript><img src="/assets/images/dns/hierarchy.jpg" alt="dns, hierarchy"></noscript></amp-img></p>

<p>Рассмотрим работу DNS и её составных частей поближе.</p>

<h3 id="терминология">Терминология</h3>

<p>Основными компонентами DNS являются:</p>

<p><strong>Домен (доменное имя)</strong> — символьное имя для обозначения сервера в сети интернет. Доменные имена являются иерархической структурой, в которой каждый уровень отделяется точкой. Основными уровнями являются:</p>

<ul>
  <li>Корневой домен. В урле он не используется, но всегда подразумевается. От него начинается построение всех урлов в сети интернет</li>
  <li>Домены верхнего уровня. К ним относятся домены .ru, .com, .net, .su и так далее. Также этот домен называют доменом первого уровня.</li>
  <li>Домен второго уровня (или основной домен). Это основное имя вашего сайта</li>
  <li>Поддомены (домены третьего, четвёртого, пятого и т.д. уровня). Сюда входят все поддомены основного домена.</li>
</ul>

<p><strong>DNS-сервер</strong> — система, ответственная за хранение и поддержание в актуальном состоянии записей о своих дочерних доменах. Каждый DNS-сервер ответственен только за свою зону, то есть DNS-сервер домена .io знает о том, где расположен домен hexlet, DNS-сервер которого знает о расположении своих поддоменов.</p>

<p><strong>Корневой DNS-сервер</strong> — система, знающая расположение (IP-адреса) DNS-серверов доменов верхнего уровня.</p>

<p><strong>Ресурсная запись</strong> — единица информации DNS-сервера. Каждая ресурсная запись имеет несколько полей:</p>

<ul>
  <li>Имя (домен, к которому относится запись)</li>
  <li>Тип</li>
  <li>Параметры</li>
  <li>Значение</li>
</ul>

<h3 id="подключение">Подключение</h3>

<p>Необходимо понимать, что доменное имя — это всего лишь абстракция для людей. Сам компьютер и приложения (например, браузер) обращается к сервисам внутри сети интернет только по IP-адресам.</p>

<p>Рассмотрим процесс получения IP-адреса по доменному имени на примере домена <code class="language-plaintext highlighter-rouge">ru.hexlet.io</code>.</p>

<p>Возможны два варианта событий:</p>

<ol>
  <li>
    <p>Компьютер посылает запрос на известный ему DNS-сервер. Чаще всего им является DNS-сервер поставщика интернет-услуг (провайдера): <em>какой IP-адрес у домена ru.hexlet.io?</em>. DNS-сервер провайдера находит в своей базе информацию о том, что домен <code class="language-plaintext highlighter-rouge">ru.hexlet.io</code> расположен по IP-адресу 104.25.238.104 и возвращает значение нашему компьютеру. Этот процесс похож на то, как использовался файл <code class="language-plaintext highlighter-rouge">hosts.txt</code>.</p>
  </li>
  <li>
    <p>Ближайший известный DNS-сервер не имеет записи о том, по какому IP-адресу располагается домен <code class="language-plaintext highlighter-rouge">ru.hexlet.io</code>. В таком случае запускается цепочка процессов, благодаря которым наш компьютер получит IP-адрес домена:</p>

    <ul>
      <li>
        <p>Так как домен является иерархической структурой, и все DNS-сервера знают IP-адреса корневых DNS-серверов, то к ним и происходит запрос на получение IP-адреса домена.</p>
      </li>
      <li>
        <p>Корневые DNS-сервера, в соответствии со своей зоной ответственности знают о том, где располагаются DNS-сервера доменов верхнего уровня. Эти адреса возвращаются DNS-серверу нашего провайдера, после чего на нужный DNS-сервер (в нашем случае на DNS-сервер домена .io) посылается запрос на получение IP-адреса домена ru.hexlet.</p>
      </li>
      <li>
        <p>В соответствии со своей зоной ответственности DNS-сервер домена верхнего уровня возвращает IP-адрес DNS-сервера домена hexlet, на который посылается запрос на получение IP-адреса поддомена ru.</p>
      </li>
      <li>
        <p>DNS-сервер возвращает IP-адреса поддомена ru, после чего DNS-сервер нашего провайдера возвращает полученный адрес на наш компьютер, который уже может обратиться к домену ru.hexlet.io по его IP-адресу.</p>
      </li>
    </ul>
  </li>
</ol>

<h3 id="рекурсия-в-dns">Рекурсия в DNS</h3>

<p>Можно заметить, что оба описанных выше варианта сильно различаются: в первом случае мы просто послали запрос и получили ответ, а во втором — возникла необходимость идти от самого корневого домена в процессе поиска нужной нам записи. Такой процесс является рекурсивным, потому что ближайший DNS-сервер непрерывно посылает запросы к другим DNS-серверам до тех пор, пока не получит необходимые ресурсные записи. Данный процесс можно визуализировать следующим образом:</p>

<p><amp-img src="/assets/images/dns/structure.jpg" alt="dns, structure" layout="responsive"><noscript><img src="/assets/images/dns/structure.jpg" alt="dns, structure"></noscript></amp-img>
<small>При запросах 1 и 2 ближайший сервер будет получать информацию о местонахождении DNS-серверов, которые входят в зону ответственности того сервера, на который был послан запрос. При запросе 3 будут получены необходимые ресурсные записи домена hexlet и его поддоменов.</small></p>

<p>Рекурсивный поиск — это достаточно долгая операция, которая к тому же сильно нагружает сеть и сами DNS-сервера. Именно для того, чтобы избавиться от рекурсии каждый DNS-сервер <a href="https://ru.wikipedia.org/wiki/%D0%9A%D1%8D%D1%88">кеширует</a> информацию о записях, которые получает, для быстрой отдачи этой информации пользователю.</p>

<p>Как видно, рекурсивный поиск предполагает нахождение конечного ответа на наш запрос путём поиска записи по всем необходимым DNS-серверам, начиная с корневого. В противовес такому способу также существует итеративный запрос, который в отличие от рекурсивного выполняет всего лишь одну итерацию — это запрос ближайшему DNS-серверу, от которого мы можем получить как закешированный ответ, так и данные той зоны, за которую он ответственен. Важно отметить, что итеративный запрос предполагает всего один такой запрос.</p>

<p>Чаще всего в интернете DNS-сервера умеют посылать рекурсивные запросы, потому что в таком случае ответ можно закешировать, что в дальнейшем позволит снизить нагрузку как на сам сервер, так и на другие DNS-сервера. Время, на которое DNS-сервер кеширует информацию, указывается в ресурсной записи DNS, о которой сейчас пойдёт речь.</p>

<h2 id="ресурсные-записи-dns">Ресурсные записи DNS</h2>

<p>Современный интернет подразумевает не только получение IP-адреса по доменному имени, но и пересылку электронной почты, подключение дополнительных сервисов аналитики к сайту, настройку защищённого протокола HTTPS. Это чаще всего делается с помощью ресурсных записей DNS.</p>

<p>Рассмотрим, какие ресурсные записи используются, и на что они указывают. Основными ресурсными записями DNS являются:</p>

<p><strong>A-запись</strong> — одна из самых важных записей. Именно эта запись указывает на IP-адрес сервера, который привязан к доменному имени.</p>

<p><strong>MX-запись</strong> — указывает на сервер, который будет использован при отсылке доменной электронной почты.</p>

<p><strong>NS-запись</strong> — указывает на DNS-сервер домена.</p>

<p><strong>CNAME-запись</strong> — позволяет одному из поддоменов дублировать DNS-записи своего родителя. Делается это для того, чтобы перенаправить запрос с одного домена на другой (чаще всего для перенаправления домена с поддоменом www на домен без такого поддомена).</p>

<p><strong>TXT-запись</strong> — в этой записи хранится текстовая информация о домене. Часто используется для подтверждения прав на владение доменом, посредством добавления определённой строки, которую присылает нам интернет-сервис.</p>

<p>Ресурсные записи почти всегда одинаковые, но для некоторых записей могут появляться другие поля, например в MX-записях также присутствует значение приоритета. В основном ресурсные записи имеют следующую структуру:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>Имя записи   TTL   Класс   Тип записи  Значение
</code></pre></div></div>

<p>Разберём подробнее:</p>

<p><strong>Имя записи</strong> — указывается домен, которому принадлежит данная ресурсная запись.</p>

<p><strong>TTL</strong> <em>(time to live / время жизни)</em> — время в секундах, на которое будет закешировано значение ресурсной записи. Это необходимо для разгрузки DNS-серверов. Благодаря кешированию и возможна ситуация, что ближайший DNS-сервер знает IP-адрес запрашиваемого домена.</p>

<p><strong>Класс</strong> — предполагалось, что DNS может работать не только в сети интернет, поэтому в записи указывается и её класс. На сегодняшний день поддерживается только одно значение — IN (Internet).</p>

<p><strong>Тип</strong> — указывает тип ресурсной записи, основные из которых были разобраны выше.</p>

<p><strong>Значение</strong> — непосредственно значение ресурсной записи. В зависимости от типа ресурсной записи значения могут быть представлены в разном виде.</p>

<p>Посмотрим, в каком виде эти записи хранятся на DNS-серверах на примере домена ya.ru. Для этого воспользуемся утилитой dig, которая получает все доступные ресурсные DNS-записи от DNS-сервера и выводит их пользователю.</p>

<p>Утилита dig является DNS-клиентом и входит в состав одного из самых распространённых DNS-серверов BIND.</p>

<script id="asciicast-wWl4mvdWBI30szBYw56uzQGrd" src="https://asciinema.org/a/wWl4mvdWBI30szBYw56uzQGrd.js" data-cols="200" data-rows="25" data-size="small" data-preload="1" async=""></script>

<h2 id="пример-реальных-записей-dns">Пример реальных записей DNS</h2>

<p><amp-img src="/assets/images/dns/output.png" alt="dns, output" layout="responsive"><noscript><img src="/assets/images/dns/output.png" alt="dns, output"></noscript></amp-img></p>

<p>Не пугайтесь такого длинного вывода. Уже сейчас можно понять почти всё, что тут указано. Разберём вывод каждой секции более детально.</p>

<p>Вывод состоит из нескольких частей:</p>

<ul>
  <li>Шапка</li>
  <li>Секция запроса</li>
  <li>Секция ответа</li>
  <li>Служебная информация</li>
</ul>

<p><strong>Шапка запроса</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>; &lt;&lt;&gt;&gt; Net::DNS::Dig 0.12 &lt;&lt;&gt;&gt; -t any ya.ru.
;;
;; Got answer.
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 52109
;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 0
</code></pre></div></div>
<p>Здесь указывается проставленные флаги нашего запроса, количество запросов и ответов, а также другая служебная информация.</p>

<p><strong>Секция запроса</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>;; QUESTION SECTION:
;ya.ru.   IN    ANY
</code></pre></div></div>

<p>В секции запроса указывается домен, к которому происходит обращение, класс записи и те записи, которые мы хотим получить. ANY указывает на то, что нужно вывести все доступные ресурсные записи, но если вы хотите поэкспериментировать с утилитой сами, то можете с помощью специального ключа получить вывод только конкретных записей, которые интересуют в настоящий момент.</p>

<p><strong>Секция ответа</strong></p>

<p>Секция ответа достаточно большая, поэтому для удобства разобьём её по типам ресурсных записей.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>;; ANSWER SECTION:
ya.ru. 	7199	IN	NS	 ns1.yandex.ru.
ya.ru. 	7199	IN	NS	 ns2.yandex.ru.

ya.ru.	599	IN	A	 87.250.250.242
ya.ru.	599	IN	AAAA	 2A02:6B8:0:0:0:0:2:242
</code></pre></div></div>

<p>Как запись A, так и AAAA-запись указывают на IP-адрес, который привязан к нашему домену. A-запись указывает IP в формате IPv4, а запись AAAA — в формате IPv6.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>ya.ru.	7199	IN	MX	 10 mx.yandex.ru.
</code></pre></div></div>

<p>MX-запись также имеет параметр приоритета. Так как серверов для отправки почты может быть несколько, то и записей может быть много, поэтому для определения основного сервера указывается приоритет записи. Чем меньше число, тем выше приоритет.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="syntax"><code>ya.ru.	3599	IN	SOA	 ns1.yandex.ru. sysadmin.yandex.ru. 2019021800 900 600 2592000 900
</code></pre></div></div>

<p><strong>Запись SOA</strong> <em>(Start of Authority)</em> указывает на несколько различных параметров:</p>

<ol>
  <li>Сервер с эталонной информацией о текущем домене</li>
  <li>Контактную информацию ответственного лица</li>
  <li>Различные параметры кеширования записей</li>
</ol>

<p>Бывают и некоторые более специфичные ресурсные записи, о которых здесь не было речи, но это не значит, что они бесполезны. Полный перечень таких записей всегда можно найти в документации (например по DNS-серверу BIND).</p>

<h2 id="выводы">Выводы</h2>

<p>DNS-сервера сейчас составляют основу всего интернета и используются почти в каждом действии пользователя в сети, будь то переход на сайт, отправка электронной почты, работы с интернет-приложением на телефоне и так далее. Поэтому знания о принципах работы DNS-серверов и основных ресурсных записях, благодаря которым и возможно перемещение по сети интернет, являются важными для разработчика.</p>

    
    
  </body>
</html>
