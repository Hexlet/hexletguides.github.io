---
layout: post
title: Что такое виртуализация?
subtitle: В чем суть этой технологии и какие бывают виды виртуализации.
summary: Виртуализация — это создание изолированных окружений в рамках одного физического компьютера. 
cover_url: "/images/virtualization/virtualization_cover.jpg"
---

У пользователей Linux или Mac иногда возникает потребность в запуске программ, работающих только в Windows, а у Windows-пользователей, особенно программистов, потребность в запуске Linux или другой версии Windows. Классический пример — игры или Photoshop.

Самый очевидный способ сделать это — купить второй компьютер, но это дорогое удовольствие. Второй вариант - поставить Windows рядом со своей основной операционной системой. Такая установка, как правило, может все сломать, но если у вас получилось, во время старта компьютера вы сможете выбрать операционную систему для загрузки. Но существует третий путь — **виртуализация**.

### Виртуализация

**Виртуализация — это создание изолированных окружений в рамках одного физического устройства** (в нашем случае — компьютера). Каждое окружение при этом выглядит как отдельный компьютер со своими характеристиками, такими как доступная память, процессор и тому подобное. Такое окружение называют набором логических ресурсов или **виртуальной машиной**.

*Виртуализация позволяет запускать операционную систему как обычную программу на вашем компьютере!*

ОС, внутри которой стартует другая ОС, называется **хост-системой**, (host) а ОС, которая работает в виртуальном окружении — **гостевой** (guest). 

Специальная программа (по сути тоже операционная система) — **гипервизор** — занимается созданием виртуальных машин и их управлением. Гипервизор обеспечивает изоляцию операционных систем друг от друга, защиту и безопасность, разделение ресурсов между запущенными ОС. В зависимости от типа используемой виртуализации, гипервизор может работать как напрямую с железом без хост системы, так и через основную операционную систему, установленную на хост-машину. В первом случае используется **аппаратная виртуализация**, во втором — **программная виртуализация**. На домашних компьютерах распространен именно второй тип.

В отличие от установки двух операционных систем рядом в одну машину, виртуализация — это гораздо более безопасный метод. В любой момент можно все снести и переустановить. Вы можете создать столько виртуальных машин, сколько нужно.

#### Аппаратная виртуализация

Как ясно из названия, аппаратная виртуализация работает благодаря поддержки со стороны железа — процессора. В отличие от программной виртуализации, гостевые операционные системы управляются гипервизором напрямую без участия хостовой ОС. 

Аппаратная виртуализация гораздо эффективнее программной, так как гипервизор, в отличие от хостовой ОС, создает очень небольшой оверхед (overhead, накладные расходы). Программная виртуализация, в свою очередь, делится на несколько подтипов, о которых подробнее можно прочитать в [Википедии](https://ru.wikipedia.org/wiki/%D0%92%D0%B8%D1%80%D1%82%D1%83%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F).

#### Контейнерная виртуализация

Особняком стоит так называемая **контейнерная виртуализация**. В отличие от предыдущих видов, она не связана с запуском ОС в изолированном окружении. При контейнерной виртуализации изоляция происходит на уровне процесса операционной системы. 

На текущий момент такой вид виртуализации существует только в Linux и доступен благодаря двум возможностям ядра: cgroups и namespaces. Они позволяют запускать всего лишь один процесс так, как будто он выполняется в своем собственном мире, со своей сетью, своим диском, своей файловой системой и так далее. При таком виде виртуализации происходит запуск процесса в **той же операционной системе и на том же ядре**, а значит вы не можете с помощью нее в Linux запустить Windows. Эту виртуализацию применяют на уровне сервисов, составляющих части программного продукта. Наиболее известные проекты: OpenVZ, Docker, LXC.

### Хостинг

Каждая виртуальная машина получит столько ресурсов, сколько вы укажете. Этим фактом особенно пользуются хостеры (компании, предоставляющие услуги веб-хостинга). Фактически на каждого пользователя создается своя собственная виртуальная машина с квотами, соответствующими выбранному тарифу (ограничения по памяти, процессору и так далее).

Кроме того, виртуализация изолирует машины друг от друга, а значит вам не придется переживать, если пользователи попытаются навредить системе или соседним пользователям. Подобная услуга обычно называется VPS (virtual private server) и в базовой комплектации стоит дешево.

Виртуальные машины позволяют эффективнее утилизировать (использовать) ресурсы железной машины. Как правило, далеко не всем пользователям нужна мощность того железа, которое стоит у хостера, да и платить за нее он не готов. А вот виртуальная машина может съедать лишь проценты от мощности железа, что позволяет на одной машине размещать десятки клиентов (а то и больше). Получается, что и пользователь доволен, и хостер заработал свои деньги.

### Виртуализация для создания сервисов высокой доступности

Виртуализация позволяет создавать инфраструктуру с высокой доступностью сервисов (high availability). Устанавливается гипервизор на каждый физический сервер, на одном из них поднимается виртуальная машина, которая позволяет из этих физических серверов собрать кластер. После того, как кластер настроен, вы можете запускать свои виртуальные машины на хостах в кластере и в случае выхода из строя одного из хостов виртуальная машина автоматически поднимется на другом.

Такой подход позволяет очень гибко управлять инфраструктурой и делает ваши сервисы независимыми от конкретного железа. Например, если вам необходимо добавить оперативной памяти в один из хостов, вы переводите его в режим обслуживания, все виртуальные машины переезжают на соседний хост без остановки и можно отключать хост-машину для обслуживания.

В частности, компания VMware предлагает использовать следующие решения для создания кластеров высокой доступности:
1. Гипервизор - VMware vSphere Hypervisor (раньше назывался ESXi). Существует бесплатная версия.
2. VMware vCenter Server - система управления кластером. Позволяет настроить политики высокой доступности для виртуальных машин (High Availability VMs Policies) а также динамическое распределение виртуальных машин по хостам в зависимости от загруженности с помощью планировщика (Distributed Resource Scheduler).

Наиболее распространённые системы виртуализации: VMware, Microsoft Hyper-V.

### Другие гайды по теме

1. [Что такое Vagrant](/vagrant). Vagrant позволяет создавать и конфигурировать легковесные, повторяемые и переносимые окружения для разработки в виртуальных машинах.
2. [Как работать с Linux используя Windows](/ubuntu-linux-in-windows). Инструкция по установке Ubuntu Linux внутри Windows с использованием различных технологий виртуализации.

---

*Кирилл Мокевнин*
