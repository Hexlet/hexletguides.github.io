---
layout: post
title: Что такое Makefile
subtitle: Полезный универсальный инструмент программиста
summary: Современный программный продукт, как правило, состоит не из одной технологии, а включает несколько языков, использует дополнительные инструменты, что приводит к появлению объёмной документации, описывающей команды каждой утилиты в проекте. В этом гайде вы узнаете как утилита make позволяет справиться с этой сложностью и унифицировать команды, независимо от технологии.
cover_url: "Путь к файлу-обложке для соц. сетей, например, /images/encoding/Unicode-Logo.jpg"
---

Это про то: https://www.youtube.com/watch?v=pK9mF5aK05Q

make - утилита для автоматизации сборки исполняемых программ и библиотек из исходного кода. Таково было изначальное предназначение. 

Утилита включена в большинство *nix дистрибутивов, что привело к его широкому распространению и повсеместному использованию.

make позволяет обеспечить универсальную автоматизацию повторяющихся задач.

```text
примеры как Makefile описывает команды install, test, start, ...
```

Зачем нужен make, когда у каждого языка и технологии имеется собственный менеджер задач? Современный программный продукт, как правило, состоит не из одной технологии, а включает несколько языков, использует дополнительные инструменты, что приводит к появлению объёмной документации, описывающей команды каждой утилиты в проекте. make - это как клей между разными технологиями.

Makefile позволяет описывать зависимость между задачами, как и менеджер задач, встроенный в конкретный язык. Но Makefile не связан технологиями и языками, что даёт возможность комбинировать задачи разных технологий. 

Все команды, описанные в Makefile позволяют проекту самодокументироваться что убирает необходимость вести документацию вручную и поддерживать её в актуальном состоянии.

Использование Makefile во всех проектах позволяет создать идентичные интерфейсы независимо от проекта, например, такие команды `make install`, `make test` и другие.

Показать как пример:
https://github.com/babel/babel/blob/main/Makefile

Инструкция по применению
```makefile
# Makefile
test:
	RAILS_ENV=test make frontend
	bin/rake test

# задача deploy зависит от test
# Эта команда выполнится только при успехе предыдущей 
deploy: test
	# можно использовать переменные окружения, чтобы менять конфигурацию
	ansibleplaybook deploy.yml -i $(ENV) -u $(USR) -v
```

```shell script
# Bash
make test

make deploy ENV=production USR=ubuntu
```

```makefile
# Makefile
test:
	echo 'run tests...'
```

```shell script
# Bash
$ ls
test

make test
make: `test` is up to date.
```

Так происходит потому что make ищет файл или каталог с таким именем для сборки исходников. Это можно изменить через флаг? `.PHONY`:

```makefile
# Makefile last line
.PHONY: test log
```

